<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Cornelius Tanui</title>
<link>https://corneliustanui.rbind.io/content/blog.html#category=R</link>
<atom:link href="https://corneliustanui.rbind.io/content/blog-r.xml" rel="self" type="application/rss+xml"/>
<description>Data and Technology</description>
<generator>quarto-1.5.57</generator>
<lastBuildDate>Wed, 11 Sep 2024 21:00:00 GMT</lastBuildDate>
<item>
  <title>Basics of Statistical Data Simulation</title>
  <dc:creator>Cornelius Tanui</dc:creator>
  <link>https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/openart-image_colorful_statistical_data_simulation.jpg" style="width:80.0%;height:100.0%" alt="Statistical Data simulation" class="figure-img"></p>
<figcaption>Image source: OpenArt</figcaption>
</figure>
</div>
<section id="sec-intro" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Simulation is the scientific process of creating an hypothetical situation that mirrors the real world phenomenon. In this article, we shall explore a few ways of generating hypothetical variables that closely resemble the data that may, for instance, be collected in a field survey. You may have asked yourself how a researcher can go about generating age values of a population without actually asking the respondents in a sample of the given population to fill a survey questionnaire asking for their ages. So, this is how.</p>
<p>Different variables require different approaches of simulation, because of the underlying <strong>probability distribution.</strong> Simply put, a probability distribution defines the pattern to which the values of a variable conform. There is always a pattern that values follow, and for us to generate (simulate) the values of a variable, we are required to know what this pattern looks like in advance. This prior knowledge of the characteristics of the pattern is known as <em>apriori</em> information, because we know it in advance largely by reading the literature. For example, if we want to simulate 100 age values from a population of epileptics, we need to ask these two questions:-</p>
<ol type="1">
<li><p>What is the usual pattern of age like for the general population? We can use a histogram to get a hint of the underlying probability distribution for age. If the histogram reveals a bell-shaped pattern, we can roughly consider the <strong>normal distribution</strong> as the underlying probability distribution. There are many other probability distributions, and normal distribution is just one of them, which also happens to be the most common for numerical variables in the field of real numbers (x ∈ ℝ).</p></li>
<li><p>What is the mean and standard deviation of the age of epileptics? The answer will allow us to reproduce the histogram in (2) above without going to the field to collect actual age data. Here, <em>mean</em> and <em>standard deviation</em> are the only parameters whose apriori values ae required.</p></li>
</ol>
<p>In this article, we shall simulate variables whose values mirror the data for the means testing instrument (MTI) used by the Government of Kenya to place university students into 5 bands for award of scholarships. This follows from <a href="https://corneliustanui.rbind.io/content/posts/MTI_Modeling_2024-09-06/">my earlier article</a> on using artificial intelligence as a more reliable alternative to the <a href="https://www.universitiesfund.go.ke/new-higher-education-funding-model/">new MTI-based university funding model in Kenya</a>.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The data is <strong>simulated</strong>, and therefore substantially differs with the actual scenario! The data is for learning purposes only, and the statistical estimates reported MUST NOT be taken as true reflection of the real-word situation.</p>
</div>
</div>
</div>
</section>
<section id="sec-lit_rev" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Literature</h1>
<p>There are a number of factors<sup>1</sup> that the new MTI-based university funding model in Kenya considers for placement of students into the 5 bands. We shall discuss each one of them and deduce the probable underlying probability distributions and their associated parametric values that will enable us to simulate these factors. We shall simulate the data for 10000 students, thus <img src="https://latex.codecogs.com/png.latex?x_i"> where <img src="https://latex.codecogs.com/png.latex?i%20=%201,%202,%203,%20...,%2010000">. Because the values are randomly generated, we shall seed the random number generator (RNG), for reproducibility purposes, with the arbitrary value of 44. Note that there is no real reason for this choice.</p>
<section id="sec-bands" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-bands"><span class="header-section-number">2.1</span> Bands</h2>
<p>This is the outcome – a categorical 5-point ordinal variable where 1 represents the most needy and 5 represents the least needy<sup>2</sup>, thus <img src="https://latex.codecogs.com/png.latex?x_%7Bij%7D"> where <img src="https://latex.codecogs.com/png.latex?j%20=%20%5C%7B1,%202,%203,%20...,%205%5C%7D">. We will assume that the first 2 or 3 bands have a fairly higher chance of occurring compared to the last bands, i.e for the <img src="https://latex.codecogs.com/png.latex?i%5E%7Bth%7D"> student, <img src="https://latex.codecogs.com/png.latex?p(x_%7Bi1%7D)%20%3E%20p(x_%7Bi2%7D)%20%3E...%20%3Ep(x_%7Bi5%7D)">. We need a probability distribution function that draws 5 numbers between 1 to 5 for 10000 observations. A multinomial distribution will do just that. We simply need to specify <img src="https://latex.codecogs.com/png.latex?n%20=%201"> (create 1 vector), <img src="https://latex.codecogs.com/png.latex?size%20=%2010000"> (number of observations), and <img src="https://latex.codecogs.com/png.latex?prob%20=%20p(x_%7Bij%7D)"> (vector of probabilities) in the function <code>rmultinom</code> from the package <code>{stats}</code>. The function is the Application Programming Interface (API) to the RNG for multinomial distribution.</p>
<p>If we use a uniform probability of <img src="https://latex.codecogs.com/png.latex?p(x_%7Bij%7D)%20=%201/5"> we will end up with a uniform distribution, but we desire a distribution that is skewed to the left. Remember that the bands are a proxy for the socio-economic status of the household, and in Kenya – as in most other countries<sup>3</sup> – the number of rich households is significantly lower than the number of poor households, therefore we need to expect more band 1 households than band 5 households.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate 5 bands via multinomial distribution with equal probabilities</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb1-3">sample1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rmultinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb1-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-7">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Counts =</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-8">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Summary =</span> V1)</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand the Counts by Summary</span></span>
<span id="cb1-11">sample2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(sample1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Counts, sample1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Summary)</span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># visualize results</span></span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(sample2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bands"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of Bands (Almost Uniform)"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/undesirable bands-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We could specify the 5 distinct probabilities <img src="https://latex.codecogs.com/png.latex?p(x_%7Bij%7D)"> by trial and error, but the most effective way to get better probabilities is to think of each observation as a sum of 5 binomial trials (<img src="https://latex.codecogs.com/png.latex?p(x)%20=%20(_x%5En)p%5Exq%5E%7Bn-x%7D">) –not to be confused with multinomial – with the probability of success in each trial being <img src="https://latex.codecogs.com/png.latex?p(x_%7Bij%7D)%20=%201/5">. Each trial results in either a success (1) or a fail (0). Summing these outcomes, the lowest possible value will be 0 (all fails), and the highest will be 5 (all successes). Therefore, each student will be assigned a value between 0 and 5 (inclusive). As it turns out, 4s and 5s are significantly fewer than 0s and 1s, regardless of the seed value of the RNG. This is exactly what we want. Finally, declare <img src="https://latex.codecogs.com/png.latex?x"> as an ordered factor because there is an intrinsic element of order or natural rank among the bands.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate probabilities via 5 binomial trails with p = 1/5</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 is added to remove band 0 and introduce band 5</span></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb2-4">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prop.table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) </span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate 5 bands via multinomial distribution</span></span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb2-8">sample1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rmultinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb2-9">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb2-10">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> prob) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-12">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Counts =</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-13">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Summary =</span> V1)</span>
<span id="cb2-14"></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand the Counts by Summary</span></span>
<span id="cb2-16">sample2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(sample1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Counts, sample1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Summary)</span>
<span id="cb2-17"></span>
<span id="cb2-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(sample2),  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bands"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of Bands (Appropriately Positively Skewed)"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/desirable bands-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gross-family-income" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="gross-family-income"><span class="header-section-number">2.2</span> Gross Family Income</h2>
<p>Income, as with bands, is expected to be a positively skewed real-valued number (<img src="https://latex.codecogs.com/png.latex?x%20%E2%88%88%20%E2%84%9D%5E+">) which can assume the negative binomial distribution with the mean of KES 20,000<sup>4</sup>. From this knowledge we can generate 10000 income values using <code>rnbinom</code> function from the package <code>{stats}</code> as shown in the code below;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20000</span>),  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Income"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of Gross Family Income"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/Gross Family Income-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geographical-location" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="geographical-location"><span class="header-section-number">2.3</span> Geographical Location</h2>
<p>We will take all the 47 counties as the distinct geographical locations from which a student is equally likely to come – although realistically, certain counties have a relatively bigger share of student population, but for simplicity, we shall ignore this fact. With that out of the way, the appropriate probability distribution that ensures each student is allocated equal probability of being drawn from any of the 47 counties is the discrete uniform distribution. We can then simulate this variable using the function <code>runif</code> from the package <code>{stats}</code> as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ceiling</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">47</span>))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Geographical Location"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Discrete Uniform Distribution of Geographical Location"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/Geographical Location-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-pov_prob_ind" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-pov_prob_ind"><span class="header-section-number">2.4</span> Poverty Probability Index</h2>
<p>We shall treat this as <img src="https://latex.codecogs.com/png.latex?x%20%5Csim%20N(%5Cmu,%20s)"> which is in the field <img src="https://latex.codecogs.com/png.latex?x%20%E2%88%88%20%E2%84%9D%5E+">. This is the so-called normal distribution, and both <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and <img src="https://latex.codecogs.com/png.latex?s"> are the mean and standard deviation apriori parameters. The probability density function itself is written as <img src="https://latex.codecogs.com/png.latex?f(x)%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20%5Csqrt(2%20%5Cpi)%7De%5E%7B%5Cfrac%7B-1%7D%7B2%7D(%5Cfrac%7Bx-%5Cmu%7D%7B%5Csigma%7D)%5E2%7D">. According to the <a href="https://www.povertyindex.org/country/kenya">PPI tool</a>, the mean index poverty for Kenya is approximately 0.3 and the standard deviation is approximately 0.2. With this apriori knowledge, we can plug the values into the <code>rnorm</code> function in the package <code>{stats}</code> as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poverty Probability Index"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal Distribution of Poverty Probability Index"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/Poverty Probability Index-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="orphans" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="orphans"><span class="header-section-number">2.5</span> Orphans</h2>
<p>This is a binary variable which indicates whether a student is an orphan or not, and therefore follows a binomial distribution with one trial (also called Bernoulli). We require the probability (rate/prevalence) of the status of being an orphan in Kenya for us to simulate the data for this variable. According to Lee <em>et al</em>. (2014), 22.2% of children aged 15 to 17 were orphans and vulnerable (OVC). Students joining university are mostly aged 17 to 20 years. We shall therefore use the rate of 0.222 to simulate this variable as shown below;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.222</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Orphan Status"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bargraph of the Distribution of Orphan Status"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/Orphans-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="disability" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="disability"><span class="header-section-number">2.6</span> Disability</h2>
<p>This is yet another binary variable which indicates whether a student has disability or does not, and therefore follows a binomial distribution with one trial. We shall use the rate of 2.2%<sup>5</sup>. Plugging this value in the <code>rbinom</code> formula, we get;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.022</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Disability Status"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bargraph of the Distribution of Disability Status"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/Disability-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="number-of-dependents" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="number-of-dependents"><span class="header-section-number">2.7</span> Number of Dependents</h2>
<p>The variable represents counts, and therefore <img src="https://latex.codecogs.com/png.latex?x%20%E2%88%88%20%E2%84%95%5E+">. Both Poisson and negative binomial distributions could model the variable effectively, but this time round we shall focus on the former. The probability mass function for Poisson distribution is given as <img src="https://latex.codecogs.com/png.latex?f(x)%20=%20%5Cfrac%7Be%5E%7B%E2%80%93%CE%BB%7D%20%CE%BB%5Ex%7D%7Bx!%7D"> where <img src="https://latex.codecogs.com/png.latex?%CE%BB"> is the parameter representing the average number of occurrences of a Poisson event per unit space or time. In this context, it is the number of dependents per household. We shall use 4 as the value for this parameter<sup>6</sup> and plug into the function <code>rpois</code> in the package <code>{stats}</code> as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of Dependents"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bargraph of the Distribution of Number of Dependents"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/Number of Dependents-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="program-costs-kes" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="program-costs-kes"><span class="header-section-number">2.8</span> Program Costs (KES)</h2>
<p>Similar to Section&nbsp;2.4, this variable is in the field <img src="https://latex.codecogs.com/png.latex?x%20%E2%88%88%20%E2%84%9D%5E+"> where <img src="https://latex.codecogs.com/png.latex?x%20%5Csim%20N(%5Cmu,%20s)"> with parameters taken to be <img src="https://latex.codecogs.com/png.latex?%5Cmu%20=%20500,000"> and <img src="https://latex.codecogs.com/png.latex?s%20=%2050,000">. Feeding these values into the normal distribution RNG, we get;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50000</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Program Costs"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of Distribution of Program Costs (KES)"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/Program Costs-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gender" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="gender"><span class="header-section-number">2.9</span> Gender</h2>
<p>Similar to Section&nbsp;2.1,this variable follows a multinomial distribution with 3 outcomes. This time round, we know the three probabilities <img src="https://latex.codecogs.com/png.latex?p(x_%7Bij%7D)"> from literature; male (49.0%), female (50.0%), and intersex (0.01%)<sup>7</sup>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># declare probabilities (values gotten from existing literature)</span></span>
<span id="cb10-2">prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.49</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.50</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate 3 outcomes via multinomial distribution</span></span>
<span id="cb10-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb10-6">sample1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rmultinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb10-7">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb10-8">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> prob) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-10">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Counts =</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-11">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Summary =</span> V1)</span>
<span id="cb10-12">  </span>
<span id="cb10-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand Counts by Summary</span></span>
<span id="cb10-14">sample2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(sample1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Counts, sample1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Summary)</span>
<span id="cb10-15"></span>
<span id="cb10-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(sample2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gender"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bargraph of Gender"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/index_files/figure-html/Gender-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-simul" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Statistical Data Simulation</h1>
<p>We shall use the following R packages (installed from <a href="https://cran.r-project.org/">CRAN</a>) to simulate our variables;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load packages</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</details>
</div>
<p>Now, let’s combine all the simulated data according to probability distributions and their associated parameters identified and considered in Section&nbsp;2 into a data-frame. Notice that bands, gross family income, and PPI are sorted to ensure that households in lower bands (band 1) are correspondingly assigned lower gross income and higher PPI. The higher the PPI, the higher the likelihood that a household is considered poor. The rest of the variables must not be sorted.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># table display setup</span></span>
<span id="cb12-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| label: tbl-simulated_data .striped .hover .primary .bordered</span></span>
<span id="cb12-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| tbl-cap: "Simulated data"</span></span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| tbl-cap-location: bottom </span></span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### bands</span></span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate probabilities via 5 binomial trials with p = 1/5</span></span>
<span id="cb12-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 is added to remove band 0 and introduce band 5</span></span>
<span id="cb12-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb12-10">prob_bands <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prop.table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) </span>
<span id="cb12-11"></span>
<span id="cb12-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate 5 bands via multinomial distribution</span></span>
<span id="cb12-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb12-14">bands1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rmultinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb12-15">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-16">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> prob_bands) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb12-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-18">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Counts =</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-19">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Summary =</span> V1)</span>
<span id="cb12-20"></span>
<span id="cb12-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand the Counts by Summary</span></span>
<span id="cb12-22">bands2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(bands1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Counts, bands1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Summary)</span>
<span id="cb12-23"></span>
<span id="cb12-24"></span>
<span id="cb12-25"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### gender</span></span>
<span id="cb12-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># declare probabilities (values gotten from existing literature)</span></span>
<span id="cb12-27">prob_gender <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.49</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.50</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb12-28"></span>
<span id="cb12-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate 3 outcomes via multinomial distribution</span></span>
<span id="cb12-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb12-31">gender1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rmultinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb12-32">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-33">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> prob_gender) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb12-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-35">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Counts =</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-36">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Summary =</span> V1)</span>
<span id="cb12-37">  </span>
<span id="cb12-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand Counts by Summary</span></span>
<span id="cb12-39">gender2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(gender1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Counts, gender1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Summary)</span>
<span id="cb12-40"></span>
<span id="cb12-41"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### wrap everything up in a data-frame</span></span>
<span id="cb12-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for reproducibility</span></span>
<span id="cb12-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb12-44">simulated_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb12-45">  </span>
<span id="cb12-46">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sorting is necessary </span></span>
<span id="cb12-47">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Bands =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.ordered</span>(bands2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb12-48">  </span>
<span id="cb12-49">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sorting is necessary</span></span>
<span id="cb12-50">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GrossFamilyIncome =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-51">                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb12-52">                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20000</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb12-53">  </span>
<span id="cb12-54">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GeographicalLocation =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ceiling</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-55">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb12-56">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">47</span>))),</span>
<span id="cb12-57">  </span>
<span id="cb12-58">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sorting is necessary</span></span>
<span id="cb12-59">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PovertyProbabilityIndex =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-60">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>,</span>
<span id="cb12-61">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decreasing =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb12-62">  </span>
<span id="cb12-63">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Orphans =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-64">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb12-65">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.222</span>)),</span>
<span id="cb12-66">  </span>
<span id="cb12-67">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Disability =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-68">                                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb12-69">                                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.022</span>)), </span>
<span id="cb12-70">  </span>
<span id="cb12-71">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NumberOfDependents =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-72">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb12-73">  </span>
<span id="cb12-74">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ProgramCostsKES =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-75">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>,</span>
<span id="cb12-76">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50000</span>)),</span>
<span id="cb12-77">  </span>
<span id="cb12-78">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Gender =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(gender2)</span>
<span id="cb12-79">)</span>
<span id="cb12-80"></span>
<span id="cb12-81"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># view data (printed on your browser)</span></span>
<span id="cb12-82">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> simulated_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Bands</th>
<th style="text-align: right;">GrossFamilyIncome</th>
<th style="text-align: left;">GeographicalLocation</th>
<th style="text-align: right;">PovertyProbabilityIndex</th>
<th style="text-align: left;">Orphans</th>
<th style="text-align: left;">Disability</th>
<th style="text-align: right;">NumberOfDependents</th>
<th style="text-align: right;">ProgramCostsKES</th>
<th style="text-align: left;">Gender</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1154</td>
<td style="text-align: left;">9</td>
<td style="text-align: right;">1.0563022</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">509734.8</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2400</td>
<td style="text-align: left;">5</td>
<td style="text-align: right;">0.9868637</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">469997.6</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2411</td>
<td style="text-align: left;">27</td>
<td style="text-align: right;">0.9790371</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">547886.0</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2494</td>
<td style="text-align: left;">22</td>
<td style="text-align: right;">0.9679570</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">420495.4</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2559</td>
<td style="text-align: left;">41</td>
<td style="text-align: right;">0.9642283</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">530990.7</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can finally save the simulated data in a desired location in the local computer disc for further use;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write data to disc</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> simulated_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./Data/simulated_data.csv"</span>))</span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> simulated_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./Data/simulated_data.rds"</span>))</span></code></pre></div>
</details>
</div>
</section>
<section id="sec-concl" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Conclusion</h1>
<p>We have covered a few ways in which data can be generated based on their known probability distributions, and the values of the parameters of those distributions obtained from existing literature.</p>
<p>Each probability distribution has a corresponding API, in the form of a function, that accesses the RNG. The API instructs the RNG to generate random numbers in a particular manner that satisfies the conditions of the probability distribution (pattern).</p>
<p>There are tens of other probability distributions that are outside the scope of this article. If you are interested in <em>mathematical statistics</em>, you may check them out. Each probability distribution describes a special phenomenon, with a wide range of real world applications.</p>
<p>However, the real world scenario may be too complex to be described by just one probability distribution, and in such a case, several distributions may be combined to create a complex (mixed) distribution that may sufficiently describe the real world scenario.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://kafu.ac.ke/images/2022/Academics/nfm/NEW_FUNDING_MODEL_-_6TH_AUGUST_2024.pdf↩︎</p></li>
<li id="fn2"><p>https://www.universitiesfund.go.ke/wp-content/uploads/2024/03/Issue-December-2023.pdf↩︎</p></li>
<li id="fn3"><p>https://www.researchgate.net/figure/US-Distribution-of-Income-Actual-vs-Lognormal-model_fig1_327971358↩︎</p></li>
<li id="fn4"><p>https://www.businessdailyafrica.com/bd/economy/kenyans-average-income-of-sh20-123-hits-six-year-high–4043204↩︎</p></li>
<li id="fn5"><p>https://devinit-prod-static.ams3.cdn.digitaloceanspaces.com/media/documents/Status-of-disability-in-Kenya__IF.pdf↩︎</p></li>
<li id="fn6"><p>https://dhsprogram.com/pubs/pdf/SR277/SR277.pdf↩︎</p></li>
<li id="fn7"><p>https://kenya.unfpa.org/en/topics/population-matters-0↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>R</category>
  <category>Simulation</category>
  <category>Mathematical Statistics</category>
  <guid>https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/</guid>
  <pubDate>Wed, 11 Sep 2024 21:00:00 GMT</pubDate>
</item>
<item>
  <title>Machine Learning Classifier for Banding University Students in Kenya</title>
  <dc:creator>Cornelius Tanui</dc:creator>
  <link>https://corneliustanui.rbind.io/content/posts/MTI_Modeling_2024-09-06/</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/MTI_Modeling_2024-09-06/ImagineArt_University_Students_in_Kenya.png" style="width:80.0%;height:100.0%" alt="Machine Learning Classifier for Banding University Students in Kenya" class="figure-img"></p>
<figcaption>Image source: Imagine Art</figcaption>
</figure>
</div>
<section id="university-funding-in-kenya" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> University Funding in Kenya</h1>
<section id="sec-shallow" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-shallow"><span class="header-section-number">1.1</span> My Shallow Thoughts on MTI</h2>
<p>When I first heard of MTI, my immediate thought was that the government of Kenya had finally embraced Artificial Intelligence on a larger scale and decided to award university students scholarships based on economic bands decided by some novel AI algorithm. Think, a combination of classification algorithms of ‘high compute, high repute’. A pleasant thought, right? No.</p>
<p>No because, later on, I searched for MTI online and found out that it stands for ‘means testing instrument’, and if you are deep into data, you would think ‘means’ is hereby used to denote average. See, ‘testing of means’ is not remotely uncommon, we come across it all the time in data analytics. T-test is a test of means. However, ‘means’ in the context of MTI stands for resources, or assets’, that a student has access to that could be used to fund their higher education. ‘Means’ can be a confusing word. ‘Means of transport’, ‘by all means’, etc.</p>
<p>As it turned out, MTI is a widely used concept in the education and social protection sectors, and I was embarrassingly waaay off in thinking that it had something to do with statistical averages.</p>
<p>I was waaay off in yet, yet again, in a different aspect – the students joining university in September, 2024 as first-years/freshmen had never been banded before, and therefore, there would be no training data for my imagined AI model! This is the first time banding is happening in Kenya, as regards university funding, so maybe, there will be (enough) data to train a model in 2025, so that the freshmen of 2025 will have successfully been banded by AI.</p>
</section>
<section id="background-to-mti" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="background-to-mti"><span class="header-section-number">1.2</span> Background to MTI</h2>
<p>Globally, MTI has been around for a while now, with the first documented use in 1930s involving provision of relief to households by governments. If a home was deemed able to support itself by the source of income it had, the the government benefits were stopped or reduced<sup>1</sup>. MTI has since been heavily employed in the social protection to provide targeted anti-poverty benefits to households, civil legal aid to individuals<sup>2</sup>, communities, and geographies. The obvious reason for preference of MTI to universal provision of support – such as universal basic income – is that MTI offers the support to targeted beneficiaries, because with the universal approach, there may be recipients who do not genuinely require it<sup>3</sup>.</p>
<p>In Kenya, MTI has been used for a long time to identify households in marginalized communities that are eligible for benefit from cash transfers<sup>4</sup> under the National Safety Net Programmes (NSNP). One such safety programme is the Hunger Safety Net Programme (HSNP) that supports old persons, orphans and vulnerable children, and persons with severe disability.</p>
<p>Literature indicates that MTI has worked successfully so far in Kenya as implemented under NSNP, yet it is not without shortcomings. For example, the popular controversy around it is, it discourages the target population from engaging in financial savings<sup>5</sup>, consequently promoting poverty, a concept known as poverty trap<sup>6</sup>. MTI sustained an unmitigated uproar over it’s banding inaccuracy<sup>7</sup> that led to placement of students from poor backgrounds into higher bands that require them to dig deep into their pockets to fill the gap, pockets which they either do not have, or are torn. The bands range from 1 (least able) to 5 (most able.)</p>
<p>Under the hood, MTI is mainly a regression model – such as a tobit model – that aggregates various variables together and provides a value<sup>3</sup> which is then compared to a threshold that determines whether the candidate qualifies for the benefit, or does not. Principal components analysis models have also been deployed to this cause<sup>4</sup>.</p>
<p>Now, let us explore how a machine learning (ML) classifier could be used as an alternative to MTI to award financial support to university students in Kenya.</p>
</section>
</section>
<section id="ml-approach-to-household-banding" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> ML Approach to Household Banding</h1>
<p>It goes without saying that a student requires a couple of lessons before sitting an exam, so does a ML model require massive – yet meticulous – training before it can be deployed for use, as noted in Section&nbsp;1.1.</p>
<p>It is not too clear how and which factors were considered to create the 5 bands, although gross family income, geographical location poverty probability index, special circumstances such as orphans and students with disability, number of dependents, program costs, and gender are some of the variables that have been mentioned<sup>8</sup>. Because I do not have readily available data covering these variables, I am going to simulate them and use R<sup>9</sup>, <a href="https://https://www.tidyverse.org//">{tidyverse}</a>, <a href="https://www.tidymodels.org/">{tidymodels}</a> and other R packages to develop a data processing, modelling, and prediction pipeline using a ML multi-class classification (MCC)<sup>10</sup> model of our choice. Note that the outcome should be in discrete ordinal scale.</p>
<section id="data-simulation" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="data-simulation"><span class="header-section-number">2.1</span> Data Simulation</h2>
<p>Simulation of these data is outside the scope of this article and is <a href="https://corneliustanui.rbind.io/content/posts/Simulation_2024-09-12/">covered in my other post</a>.</p>
<p>The table below shows the properties of the variables are;</p>
<div id="tbl-properties" class="striped hover primary bordered quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Properties of variables
</figcaption>
<div aria-describedby="tbl-properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover table-primary table-bordered caption-top table">
<colgroup>
<col style="width: 56%">
<col style="width: 15%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Data type</th>
<th style="text-align: left;">Distribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bands</td>
<td style="text-align: left;">Ordinal</td>
<td style="text-align: left;">Multinomial</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gross family income</td>
<td style="text-align: left;">x ∈ ℝ<sup>+</sup></td>
<td style="text-align: left;">Negative Binomial</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Geographical location</td>
<td style="text-align: left;">Nominal</td>
<td style="text-align: left;">Uniform</td>
</tr>
<tr class="even">
<td style="text-align: left;">Poverty probability index</td>
<td style="text-align: left;">x ∈ ℝ<sup>+</sup></td>
<td style="text-align: left;">Skewed Normal</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Special circumstances such as orphans</td>
<td style="text-align: left;">Binary</td>
<td style="text-align: left;">Binomial</td>
</tr>
<tr class="even">
<td style="text-align: left;">Students with disability</td>
<td style="text-align: left;">Binary</td>
<td style="text-align: left;">Binomial</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of dependents</td>
<td style="text-align: left;">x ∈ ℕ<sup>+</sup></td>
<td style="text-align: left;">Poisson</td>
</tr>
<tr class="even">
<td style="text-align: left;">Program costs</td>
<td style="text-align: left;">x ∈ ℝ<sup>+</sup></td>
<td style="text-align: left;">Skewed Normal</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gender</td>
<td style="text-align: left;">Nominal</td>
<td style="text-align: left;">Multinomial</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="descrpitive-analysis" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="descrpitive-analysis"><span class="header-section-number">2.2</span> Descrpitive Analysis</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Disclaimer!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The data is <strong>simulated</strong>, and therefore substantially differs with the actual scenario! The data is meant for learning purposes only, and the statistical estimates reported MUST NOT be taken as true reflection of the real-word situation.</p>
</div>
</div>
</div>
<p>The simulated data looks like this;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># table display setup</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| label: tbl-simulated_data .striped .hover .primary .bordered</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| tbl-cap: "Simulated data"</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| tbl-cap-location: bottom </span></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load data</span></span>
<span id="cb1-7">simulated_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./Data/simulated_data.rds"</span>))</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># view data (printed on your browser)</span></span>
<span id="cb1-10">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> simulated_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Bands</th>
<th style="text-align: right;">GrossFamilyIncome</th>
<th style="text-align: left;">GeographicalLocation</th>
<th style="text-align: right;">PovertyProbabilityIndex</th>
<th style="text-align: left;">Orphans</th>
<th style="text-align: left;">Disability</th>
<th style="text-align: right;">NumberOfDependents</th>
<th style="text-align: right;">ProgramCostsKES</th>
<th style="text-align: left;">Gender</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">1154</td>
<td style="text-align: left;">9</td>
<td style="text-align: right;">1.0563022</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">509734.8</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2400</td>
<td style="text-align: left;">5</td>
<td style="text-align: right;">0.9868637</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">469997.6</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2411</td>
<td style="text-align: left;">27</td>
<td style="text-align: right;">0.9790371</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">547886.0</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2494</td>
<td style="text-align: left;">22</td>
<td style="text-align: right;">0.9679570</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">420495.4</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">2559</td>
<td style="text-align: left;">41</td>
<td style="text-align: right;">0.9642283</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">530990.7</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="inferential-model-creation" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="inferential-model-creation"><span class="header-section-number">2.3</span> Inferential Model Creation</h2>
<p>Before we create a model that predicts or assigns bands, let’s first explore the relationship between the outcome (Bands) and all the predictors.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">mti_model_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> parsnip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">multinom_reg</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-2">  parsnip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(Bands <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> simulated_data)</span></code></pre></div>
</details>
</div>
<p>Now, we can extract the meaning from the information contained in the model created above. Instead of reporting log of odds, we can report just odd, as that make sit easier to interpret;-</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">model_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(mti_model_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">exponentiate =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-2">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Bands =</span> y.level, </span>
<span id="cb3-3">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Predictors =</span> term,</span>
<span id="cb3-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Odds =</span> estimate,</span>
<span id="cb3-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">StandardError =</span> std.error,</span>
<span id="cb3-6">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Statistic =</span> statistic,</span>
<span id="cb3-7">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">P-value</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> p.value,</span>
<span id="cb3-8">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower95 =</span> conf.low,</span>
<span id="cb3-9">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Upper95 =</span> conf.high</span>
<span id="cb3-10">                ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-11">  </span>
<span id="cb3-12">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Odds =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(Odds, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb3-13">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower95 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(Lower95, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb3-14">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Upper95 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(Upper95, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb3-15"></span>
<span id="cb3-16">model_results</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 216 × 8
   Bands Predictors             Odds StandardError Statistic `P-value`   Lower95
   &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 2     (Intercept)       Inf            1.02e- 7   8.92e10         0 Inf      
 2 2     GrossFamilyIncome   8.08e-1      5.51e- 4  -3.88e 2         0   8.07e-1
 3 2     GeographicalLoca…   5.48e+0      1.47e- 8   1.16e 8         0   5.48e+0
 4 2     GeographicalLoca…   5.75e+3      1.13e- 9   7.66e 9         0   5.75e+3
 5 2     GeographicalLoca…   4   e-4      3.44e- 8  -2.27e 8         0   4   e-4
 6 2     GeographicalLoca…   2.73e+2      1.36e- 9   4.14e 9         0   2.73e+2
 7 2     GeographicalLoca…   1.37e+2      5.31e- 9   9.26e 8         0   1.37e+2
 8 2     GeographicalLoca…   8.7 e-3      2.86e- 8  -1.66e 8         0   8.7 e-3
 9 2     GeographicalLoca…   0            3.19e- 8  -4.16e 8         0   0      
10 2     GeographicalLoca…   1.66e+6      1.40e-16   1.02e17         0   1.66e+6
# ℹ 206 more rows
# ℹ 1 more variable: Upper95 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>A multinomial regression is, under the hood, an ensemble of several “binary logistic regressions”. As we can see from the results above, the outcome <code>Bands</code> contains all the outcome bands (technically called ‘classes’). Each class creates a binary logistic regression, and that is why we see all the <code>Predictors</code> for each class. Band 1 (class 1) is not reported because it is taken as the reference group. Any class can be made a reference groub by relevelling the factors. For example, to make band 5 the reference class, <code>simulated_data$Bands &lt;- relevel(simulated_data$Bands, ref = "5")</code>.</p>
<p>Looking at the p-values at 95% level of confidence, some independent indicators are significant predictors of certain bands. For instance, gross family income is significant at all bands (p-value &lt;0.0001) respectively.) Therefore, a unit increase of a gross family income increases the odds of the family being in band 4 than being in band 1 by 25.07%, holding all other predictors constant. The value of 25.07% is gotten by <img src="https://latex.codecogs.com/png.latex?(1.2507%20-%201)*100%20=%2025.07%5C%25">.</p>
</section>
<section id="prediction-model-creation" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="prediction-model-creation"><span class="header-section-number">2.4</span> Prediction Model Creation</h2>
<p>For a start, we shall define the the model pipeline using the conventional <em>tidymodels</em> process workflow with <a href="https://parsnip.tidymodels.org/">parsnip</a>, and specify <em>glmnet</em> as the engine. Later on, maybe in a separate post, we will explore other engines such as <em>brulee</em>, <em>nnet</em>, and <em>keras</em>. The keras engine is a Python library that depends on <em>tensorflow</em>, another Python library that must be installed. To install keras and tensorflow, open <strong>Anaconda Command Prompt</strong> and run the commands <code>pip install keras</code>, and <code>pip install tensorflow</code> and then load the R package equivalents of the two python libraries, along with other necessary packages, as follows: -</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## load packages</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data processing packages</span></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidymodels) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># model definition packages</span></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(parsnip)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># model manipulation functions</span></span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glmnet)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># model processing engine</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(spark)      # model processing engine</span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(keras)      # model processing engine (requires package tensorflow)</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(tensorflow) # The Python package needs to be installed</span></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(nnet)       # model processing engine</span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(brulee)     # model processing engine (requires libtorch distro of PyTorch)</span></span></code></pre></div>
</details>
</div>
<section id="generate-training-and-testing-datasets" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="generate-training-and-testing-datasets"><span class="header-section-number">2.4.1</span> Generate Training and Testing Datasets</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## create training and testing sets</span></span>
<span id="cb6-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set seed for reproducibility of the sets</span></span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>)</span>
<span id="cb6-4">data_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial_split</span>(simulated_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>)</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 75% of records</span></span>
<span id="cb6-7">train_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">training</span>(data_split) </span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 25% of records</span></span>
<span id="cb6-10">test_data  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">testing</span>(data_split)</span></code></pre></div>
</details>
</div>
</section>
<section id="create-initial-model" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="create-initial-model"><span class="header-section-number">2.4.2</span> Create Initial Model</h3>
<p>In this model, there are only two (hyper)parameters that need to be specified: penalty and mixture. The value of the penalty defines the degree to which <em>regularization</em> is applied to the model. Regularization is a technique used to control overfitting by adding a penalty (error) term to the model. On the other hand, mixture is the value that species how the penalty term is added. There are three ways of adding this penalty<sup>11</sup>;</p>
<ol type="1">
<li>Lasso (also called L1 regularization): The penalty term added to the model is the sum of absolute coefficients of the predictors, multiplied by some constant – <img src="https://latex.codecogs.com/png.latex?%CE%BB%E2%88%91%20%7C%CE%B2%7C">. If <img src="https://latex.codecogs.com/png.latex?mixture%20=%201"> then the resulting model is pure L1.</li>
<li>Ridge (also called L2 regularization): The penalty term added to the model is the sum of squares of coefficients of the predictors, multiplied by some constant – <img src="https://latex.codecogs.com/png.latex?%CE%BB%E2%88%91%20%CE%B2%5E2">. If <img src="https://latex.codecogs.com/png.latex?mixture%20=%200"> then the resulting model is pure L2.</li>
<li>Elastic net (a mix of L1 and L2): The penalty term added to the model is the sum of L1 and L2 – <img src="https://latex.codecogs.com/png.latex?%CE%BB%E2%88%91%20%7C%CE%B2%7C%20+%20%CE%BB%E2%88%91%20%CE%B2%C2%B2">. If <img src="https://latex.codecogs.com/png.latex?0%20%3C%20mixture%20%3C%201"> then the resulting model is elastic net.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create the null model</span></span>
<span id="cb7-2">multinom_reg_glmnet_spec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb7-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parsnip::multinom_reg(penalty = tune(), mixture = tune()) |&gt; # to be tuned later</span></span>
<span id="cb7-4">  parsnip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">multinom_reg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">penalty =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">double</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mixture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">double</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># manual starting values</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'glmnet'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"classification"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="recipe-definition" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="recipe-definition"><span class="header-section-number">2.4.3</span> Recipe Definition</h3>
<p>Create pre-processing steps for the predictors (also called features.);</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create the recipe</span></span>
<span id="cb8-2">multinom_recipe <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb8-3">  </span>
<span id="cb8-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify the outcome variable</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recipe</span>(Bands <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> train_data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-6">  </span>
<span id="cb8-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify predictors to be one-hot-encoded</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_dummy</span>(GeographicalLocation, Gender, Orphans, Disability) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-9">  </span>
<span id="cb8-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># center all normally distributed predictors  </span></span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_center</span>(GrossFamilyIncome, PovertyProbabilityIndex, NumberOfDependents, ProgramCostsKES) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-12">  </span>
<span id="cb8-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale all normally distributed predictors </span></span>
<span id="cb8-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_scale</span>(GrossFamilyIncome, PovertyProbabilityIndex, NumberOfDependents, ProgramCostsKES) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-15">  </span>
<span id="cb8-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalize all numeric variables</span></span>
<span id="cb8-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_normalize</span>(GrossFamilyIncome, PovertyProbabilityIndex, NumberOfDependents, ProgramCostsKES)</span></code></pre></div>
</details>
</div>
</section>
<section id="workflow-definition" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="workflow-definition"><span class="header-section-number">2.4.4</span> Workflow Definition</h3>
<p>A workflow defines the order in which the model is build by sequentially combining pre-processing steps (recipe) and other pipeline elements into a workflow;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create the workflow</span></span>
<span id="cb9-2">multinom_workflow <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_recipe</span>(multinom_recipe) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_model</span>(multinom_reg_glmnet_spec)  </span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="model-training" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="model-training"><span class="header-section-number">2.5</span> Model Training</h2>
<p>We can now train(fit) the model using the training data as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># train model</span></span>
<span id="cb10-2">multinom_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb10-3">  multinom_workflow <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-4">  parsnip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> train_data)</span></code></pre></div>
</details>
</div>
</section>
<section id="model-performance-diagnostics" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="model-performance-diagnostics"><span class="header-section-number">2.6</span> Model Performance Diagnostics</h2>
<p>Now that we have a ‘bare bones’ model, let’s find out it’s performance using metrics from the <a href="https://yardstick.tidymodels.org/">yardstick</a> package, which is part of tidymodels. There are many ways to calculate multiclass metrics, such as using confusion matrix and accuracy level. Note that ROC (receiver operating characteristic) curve is used for binary classifiers, not multiclass classifiers which is the focus of this article.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create new data (can be completely new or use training data without resposne variable)</span></span>
<span id="cb11-2">predictors_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> test_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Bands)</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use the model and the training data to get predictions of bands</span></span>
<span id="cb11-5">bands_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> test_data</span>
<span id="cb11-6">bands_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Bands_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(multinom_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_data =</span> predictors_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"class"</span>)</span>
<span id="cb11-7">bands_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Bands_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bands_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Bands_pred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>.pred_class</span>
<span id="cb11-8"></span>
<span id="cb11-9">bands_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bands_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Bands, Bands_pred)</span>
<span id="cb11-10"></span>
<span id="cb11-11"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## measure performance</span></span>
<span id="cb11-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1) confusion matrix</span></span>
<span id="cb11-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">conf_mat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> bands_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> Bands, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> Bands_pred)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   1   2   3   4   5
         1 819  83   0   0   0
         2   3 931 135   0   0
         3   0   0 382 120   0
         4   0   0   0   1   2
         5   0   0   0   2  22</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2) kappa and accuracy</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metrics</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> bands_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> Bands, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> Bands_pred)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy multiclass     0.862
2 kap      multiclass     0.793</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3) precision (same as accuracy)</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precision</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> bands_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> Bands, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> Bands_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimator =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"micro"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric   .estimator .estimate
  &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
1 precision micro          0.862</code></pre>
</div>
</div>
<p>There you go; a model accuracy of 0.862 is pretty high, given that the data was <em>simulated</em>! So much good news here, almost too good to be true. And what’s more, this is a basic model, i.e.&nbsp;the (hyper)parameters <em>penalty</em> and <em>mixture</em> have the conservative values of <code>doubel(1)</code>. Are we able to improve the accuracy further by changing these values, i.e.&nbsp;by tuning them? Let’s find out below.</p>
</section>
<section id="hyperparameter-tuning" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="hyperparameter-tuning"><span class="header-section-number">2.7</span> Hyperparameter Tuning</h2>
<p>Note that the mixture and penalty levels (values) are arbitrarily set to 3 and 2 respectively – these are simply starting points, and can be any numbers but the closer they are to the optimal values the quicker it is for the grid search to converge to those optimal values, which saves the computer tonnes of processing resources and time. The same goes for cross-validation of 3 folds.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define model</span></span>
<span id="cb17-2">multinom_reg_glmnet_spec_tuned <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb17-3">  parsnip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">multinom_reg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">penalty =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tune</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mixture =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tune</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to be tuned</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'glmnet'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"classification"</span>)</span>
<span id="cb17-6"></span>
<span id="cb17-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define grid search</span></span>
<span id="cb17-8">multinom_grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid_regular</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mixture</span>(), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">penalty</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mixture =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">penalty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb17-9"></span>
<span id="cb17-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define work flow</span></span>
<span id="cb17-11">multinom_wf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_recipe</span>(multinom_recipe) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb17-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_model</span>(multinom_reg_glmnet_spec_tuned)</span>
<span id="cb17-14"></span>
<span id="cb17-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define 3-fold CV resamples from which to search best parameter values</span></span>
<span id="cb17-16">multinom_3f_cv_folds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vfold_cv</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> train_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb17-17"></span>
<span id="cb17-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tune the hyperparameters using the grid search</span></span>
<span id="cb17-19">multinom_tuned <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tune_grid</span>(</span>
<span id="cb17-20">  multinom_wf,</span>
<span id="cb17-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resamples =</span> multinom_3f_cv_folds,</span>
<span id="cb17-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid =</span> multinom_grid,</span>
<span id="cb17-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">control_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">save_pred =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb17-24">)</span>
<span id="cb17-25"></span>
<span id="cb17-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select_best</span>(multinom_tuned, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accuracy"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
       penalty mixture .config             
         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 0.0000000001       1 Preprocessor1_Model5</code></pre>
</div>
</div>
<p>From the above grid search, we got <img src="https://latex.codecogs.com/png.latex?penalty%20=%200.0000000001"> and <img src="https://latex.codecogs.com/png.latex?mixture%20=%201">. Let’s plug these values into the model and see if the accuracy has improved;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create the null model</span></span>
<span id="cb19-2">multinom_reg_glmnet_spec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb19-3">  parsnip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">multinom_reg</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">penalty =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0000000001</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mixture =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'glmnet'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"classification"</span>)</span>
<span id="cb19-6"></span>
<span id="cb19-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rerun the workflow now that model has been updated</span></span>
<span id="cb19-8">multinom_workflow <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb19-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb19-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_recipe</span>(multinom_recipe) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb19-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_model</span>(multinom_reg_glmnet_spec)</span>
<span id="cb19-12"></span>
<span id="cb19-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># re-train the model based on new parameters</span></span>
<span id="cb19-14">multinom_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb19-15">  multinom_workflow <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb19-16">  parsnip<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> train_data)</span>
<span id="cb19-17"></span>
<span id="cb19-18"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## measure performance of new model</span></span>
<span id="cb19-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create new data (can be completely new or use training data without resposne variable)</span></span>
<span id="cb19-20">predictors_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> test_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Bands)</span>
<span id="cb19-21"></span>
<span id="cb19-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use the model and the training data to get predictions of bands</span></span>
<span id="cb19-23">bands_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> test_data</span>
<span id="cb19-24">bands_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Bands_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(multinom_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_data =</span> predictors_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"class"</span>)</span>
<span id="cb19-25">bands_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Bands_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bands_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Bands_pred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>.pred_class</span>
<span id="cb19-26"></span>
<span id="cb19-27">bands_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bands_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Bands, Bands_pred)</span>
<span id="cb19-28"></span>
<span id="cb19-29"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## measure performance</span></span>
<span id="cb19-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1) confusion matrix</span></span>
<span id="cb19-31"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">conf_mat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> bands_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> Bands, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> Bands_pred)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction    1    2    3    4    5
         1  817    2    0    0    0
         2    5 1006    6    0    0
         3    0    6  506    2    0
         4    0    0    5  121    0
         5    0    0    0    0   24</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2) kappa and accuracy</span></span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metrics</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> bands_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> Bands, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> Bands_pred)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy multiclass     0.990
2 kap      multiclass     0.985</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3) precision (same as accuracy)</span></span>
<span id="cb23-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precision</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> bands_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> Bands, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> Bands_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimator =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"micro"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric   .estimator .estimate
  &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
1 precision micro          0.990</code></pre>
</div>
</div>
<p>There is a huge improvement on model performance; we went from an accuracy of 0.862 to an accuracy of 0.9896! This is no small feat at all. Wonder if this can be improved further? Maybe, maybe not. At this point, there is no sensible need to go further.</p>
</section>
<section id="band-prediction" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="band-prediction"><span class="header-section-number">2.8</span> Band Prediction</h2>
<p>Now that we have a reasonably reliable model, we can ask it to place a student into bands. All we need to do is provide the values of “GrossFamilyIncome”, “GeographicalLocation”, “PovertyProbabilityIndex”, “Orphans”, “Disability”, “NumberOfDependents”, “ProgramCostsKES”, and “Gender” for a particular student in the <code>new_data</code> argument of the <code>predict</code> function, as follows;</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># enter new student data</span></span>
<span id="cb25-2">new_student_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb25-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GrossFamilyIncome =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>,</span>
<span id="cb25-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GeographicalLocation =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb25-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PovertyProbabilityIndex =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>,</span>
<span id="cb25-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Orphans =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb25-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Disability =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb25-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NumberOfDependents =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb25-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ProgramCostsKES =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>, </span>
<span id="cb25-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Gender =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb25-11">)</span>
<span id="cb25-12"></span>
<span id="cb25-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># predict new student band</span></span>
<span id="cb25-14">new_student_band <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(multinom_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_data =</span> new_student_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"class"</span>)</span>
<span id="cb25-15"></span>
<span id="cb25-16">new_student_band</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  .pred_class
  &lt;fct&gt;      
1 1          </code></pre>
</div>
</div>
<p>The new student above, as reasonably expected, is assigned band 1. “Reasonably expected’ because the student comes from a family of low gross income, high poverty probability index, and is orphaned and disabled.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Conclusion</h1>
<p>As we have seen, this is an advanced, machine learning way to create bands for students seeking to join the university. As an alternative to MTI, the ML model is scientifically sound, reliable, faster, and scalable. It gets even better as more and more training data becomes available over time, which enables the ML model to “learn” more about what it is excepted to do, therefore improving the banding accuracy.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>van Oorschot, W. J. H., &amp; Schell, J. (1991). Means-testing in Europe: A growing concern. In M. Adler, C. Bell, J. Clasen, &amp; A. Sinfield (Eds.), The sociology of social security (pp.&nbsp;187-211). (Edinburgh education and society series). Edinburgh University Press.↩︎</p></li>
<li id="fn2"><p>https://www.gov.uk/guidance/criminal-legal-aid-means-testing↩︎</p></li>
<li id="fn3"><p>Brown, C., Ravallion, M., &amp; Van de Walle, D. (2016). A poor means test. Econometric targeting in Africa. The World Bank.↩︎</p></li>
<li id="fn4"><p>Villa, Juan M. [2016] A harmonised proxy means test for Kenya’s National Safety Net programme. GDI Working Paper 2016-003. Manchester: The University of Manchester.↩︎</p></li>
<li id="fn5"><p>Elizabeth T. Powers,Does means-testing welfare discourage saving? evidence from a change in AFDC policy in the United States, Journal of Public Economics, Volume 68, Issue 1, 1998, Pages 33-53, ISSN 0047-2727, https://doi.org/10.1016/S0047-2727(97)00087-X. (https://www.sciencedirect.com/science/article/pii/S004727279700087X)↩︎</p></li>
<li id="fn6"><p>Kraay, Aart, and David McKenzie. 2014. “Do Poverty Traps Exist? Assessing the Evidence.” Journal of Economic Perspectives, 28 (3): 127–48.↩︎</p></li>
<li id="fn7"><p>https://www.citizen.digital/news/govt-explains-why-many-students-miss-out-on-scholarships-under-the-new-funding-model-n348207↩︎</p></li>
<li id="fn8"><p>https://kafu.ac.ke/images/2022/Academics/nfm/NEW_FUNDING_MODEL_-_6TH_AUGUST_2024.pdf↩︎</p></li>
<li id="fn9"><p>R Core Team (2021). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.↩︎</p></li>
<li id="fn10"><p>Kook, L., Herzog, L., Hothorn, T., Dürr, O., &amp; Sick, B. (2022). Deep and interpretable regression models for ordinal outcomes. Pattern Recognition, 122, 108263.↩︎</p></li>
<li id="fn11"><p>https://www.geeksforgeeks.org/lasso-vs-ridge-vs-elastic-net-ml/↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>R</category>
  <category>Classification</category>
  <category>Prediction</category>
  <category>MTI</category>
  <guid>https://corneliustanui.rbind.io/content/posts/MTI_Modeling_2024-09-06/</guid>
  <pubDate>Mon, 05 Aug 2024 21:00:00 GMT</pubDate>
</item>
<item>
  <title>Modelling CPI Using ARIMA(p,d,q)</title>
  <dc:creator>Cornelius Tanui</dc:creator>
  <link>https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/ImagineArt_TimeSeriesGraph.png" style="width:80.0%;height:100.0%" alt="Modelling CPI Using ARIMA(p,d,q)" class="figure-img"></p>
<figcaption>Image source: Imagine Art</figcaption>
</figure>
</div>
<section id="why-cpi-is-time-series" class="level3">
<h3 class="anchored" data-anchor-id="why-cpi-is-time-series">1) Why CPI is Time Series</h3>
<p>Consumer Price Index (CPI) is defined as a measure of the weighted aggregate change in retail prices paid by consumers for a given basket of goods and services.</p>
<p>The CPI is a statistical indicator of changes in consumer prices experienced by citizens of a country. It is a measure that compares the cost of a fixed basket (234 items) of goods and services purchased by consumers over time. The CPI index reflects only pure price change and is a widely used to monitor the rate of inflation, which is the percentage change of CPI over one year (<a href="https://www.knbs.or.ke/">The Kenya National Bureau of Statistics (KNBS)</a>, 2010).</p>
<p>CPI is a univariate non-stationary time series variable which does not have significant seasonality. Univariate because it is a single variable that predicts (or correlates to) itself based on its own history (auto-regressive) as opposed to an ordinary regression variable that is predicted by one or more variables of different nature. Furthermore, CPI is a time series variable since observed values are indexed in time. The fact that it naturally has an upward trend, possibly due to increasing population, changing lifestyles of people, and a generally growing economy means it is not stationary. Another important characteristic of CPI is periodicity. That is, observations are made more than once a year, in this case twelve times per year. This shows that CPIs are monthly realizations of onward (monotone increasing) right-continuous random variable in positive real line.</p>
<p>The data I will be using is obtained from KNBS and runs from March 1962 to September 2020.</p>
</section>
<section id="loading-the-required-packages" class="level3">
<h3 class="anchored" data-anchor-id="loading-the-required-packages">2) Loading the Required Packages</h3>
<p>The following packages are required to perform this modelling; -</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readxl)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(forecast)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tseries)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggTimeSeries)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span></code></pre></div>
</div>
</section>
<section id="loading-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-data">3) Loading Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import data</span></span>
<span id="cb2-2">CPI_Data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./Data/Historical CPI series 2020.xlsx"</span>))</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># view data</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(CPI_Data, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   `MONTHLY CPI FROM 1962` ...2  ...3               
   &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;              
 1 &lt;NA&gt;                    &lt;NA&gt;  &lt;NA&gt;               
 2 Year                    Month Index              
 3 1962                    Mar   0.47503449374032269
 4 &lt;NA&gt;                    Jun   0.48014239152247667
 5 &lt;NA&gt;                    Sep   0.48525028930463066
 6 &lt;NA&gt;                    Dec   0.49035818708678469
 7 1963                    Mar   0.48525028930463066
 8 &lt;NA&gt;                    Jun   0.49035818708678469
 9 &lt;NA&gt;                    Sep   0.50057398265109265
10 &lt;NA&gt;                    Dec   0.50568188043324669</code></pre>
</div>
</div>
<p>The column names are in row 2, this can be corrected as;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign headers </span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(CPI_Data) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CPI_Data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ]</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># drop records when Month is blank or has the string "Month"</span></span>
<span id="cb4-5">CPI_Data_clean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Month) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> Month <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Month"</span>)</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fill in blank years</span></span>
<span id="cb4-9">CPI_Data_clean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CPI_Data_clean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fill</span>(Year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"down"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Index =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(Index),</span>
<span id="cb4-12">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Year =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(Year))</span>
<span id="cb4-13"></span>
<span id="cb4-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># view data</span></span>
<span id="cb4-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(CPI_Data_clean, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
    Year Month Index
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
 1  1962 Mar   0.475
 2  1962 Jun   0.480
 3  1962 Sep   0.485
 4  1962 Dec   0.490
 5  1963 Mar   0.485
 6  1963 Jun   0.490
 7  1963 Sep   0.501
 8  1963 Dec   0.506
 9  1964 Mar   0.501
10  1964 Jun   0.501</code></pre>
</div>
</div>
</section>
<section id="declaring-cpi-as-time-series" class="level3">
<h3 class="anchored" data-anchor-id="declaring-cpi-as-time-series">4) Declaring CPI as Time Series</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">CPI_Data_ts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CPI_Data_clean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Year, Month, Index) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1962</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), </span>
<span id="cb6-4">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>), </span>
<span id="cb6-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frequency =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(CPI_Data_ts)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check the class, technically this is a univariate ts</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mts"    "ts"     "matrix" "array" </code></pre>
</div>
</div>
</section>
<section id="visualisation-of-trend" class="level3">
<h3 class="anchored" data-anchor-id="visualisation-of-trend">5) Visualisation of Trend</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">CPI_Data_clean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter(Year &lt; 1984) %&gt;% </span></span>
<span id="cb8-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mutate(Index = round(as.numeric(Index))) %&gt;% </span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Index, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trend"</span>),</span>
<span id="cb8-7">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gam"</span>, </span>
<span id="cb8-8">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb8-9">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maroon"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1960</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-13"></span>
<span id="cb8-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb8-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CPI"</span>,</span>
<span id="cb8-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CPI &amp; It's Trend, 1962 to 2020"</span>,</span>
<span id="cb8-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Trend is Approximated using GAM"</span>,</span>
<span id="cb8-18">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Figure 1"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-19">  </span>
<span id="cb8-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># custom theme</span></span>
<span id="cb8-21">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb8-22">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb8-23">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.5</span>,</span>
<span id="cb8-24">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"serif"</span>,</span>
<span id="cb8-25">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-26">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italic"</span>,</span>
<span id="cb8-27">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb8-28">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.5</span>,</span>
<span id="cb8-29">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"serif"</span>,</span>
<span id="cb8-30">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-31">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb8-32">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.5</span>,</span>
<span id="cb8-33">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"serif"</span>,</span>
<span id="cb8-34">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-35">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plain"</span>,</span>
<span id="cb8-36">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb8-37">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"serif"</span>,</span>
<span id="cb8-38">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-39">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>,</span>
<span id="cb8-40">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.5</span>,</span>
<span id="cb8-41">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"serif"</span>,</span>
<span id="cb8-42">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-43">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb8-44">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-45">            </span>
<span id="cb8-46">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb8-47">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), </span>
<span id="cb8-48">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plain"</span>,</span>
<span id="cb8-49">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb8-50">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"serif"</span>,</span>
<span id="cb8-51">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-52">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, </span>
<span id="cb8-53">                                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb8-54">            </span>
<span id="cb8-55">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.box =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horizontal"</span>,</span>
<span id="cb8-56">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cm'</span>),</span>
<span id="cb8-57">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.spacing.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cm'</span>),</span>
<span id="cb8-58">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-59">            </span>
<span id="cb8-60">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb8-61">                                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb8-62">                                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-63">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-64">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-65">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-66">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-67">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>),</span>
<span id="cb8-68">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/show trend-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Figure 1 above shows upward rise in CPI over the years, the upwardness is indicative of trend, and therefore non-stationarity. This further implies that the CPI is constituted by multiplicative components; trend, seasonality, and random effects. Since it is multiplicative, applying log-transformation makes it easy to extract the random component by differencing, which also stabilizes variance and reduces seasonality. Even though the plot is ragged, seasonality is not immediately evident.</p>
<p>To extract seasonality, <strong>Seasonal Trend Loess</strong> decomposer (<code>tslm()</code>) is invoked. The decomposer, which works better than <code>decompose()</code>, is used for periodic time series, the periodicity (seasonal window) here is 4 months.</p>
</section>
<section id="decomposition-of-cpi" class="level3">
<h3 class="anchored" data-anchor-id="decomposition-of-cpi">6) Decomposition of CPI</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">CPI_Data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts</span>(CPI_Data_clean<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Index, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1962</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frequency =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb9-2"></span>
<span id="cb9-3">decompose_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tslm</span>(CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> trend <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fourier</span>(CPI_Data, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb9-4"></span>
<span id="cb9-5">trend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(decompose_df)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(decompose_df)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trend'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_along</span>(CPI_Data)</span>
<span id="cb9-6"></span>
<span id="cb9-7">components <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(</span>
<span id="cb9-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> CPI_Data,</span>
<span id="cb9-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trend =</span> trend,</span>
<span id="cb9-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">season =</span> CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> trend <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(decompose_df),</span>
<span id="cb9-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">remainder =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(decompose_df))</span>
<span id="cb9-12"></span>
<span id="cb9-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoplot</span>(components, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">facet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/decompose-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot above shows the individual components of CPI;</p>
<ul>
<li>Trend,</li>
<li>Seasonality, and</li>
<li>Random error.</li>
</ul>
<p>Here, seasonal fluctuations are more evident. The trend has been smoothed, i.e.&nbsp;it is devoid of seasonality and random error. To explore seasonality:-</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">adjust_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> components[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'season'</span>]</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoplot</span>(CPI_Data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">series =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autolayer</span>(adjust_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">series =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Seasonally adjusted"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/decompose1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is evident that the rate of consumption exponentially rose in the early ’80s to early ’90s. The sinusoidal aspect of seasonality is revealed by the plot below. Consumption goes down in April by a seasonal effect of 0.25 and goes up around July by an effect of 0.65 every year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">window</span>(components[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>],</span>
<span id="cb11-2">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb11-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb11-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Seasonlity of CPI, 2016 to 2018"</span>,</span>
<span id="cb11-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Months"</span>,</span>
<span id="cb11-6">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effects"</span>,</span>
<span id="cb11-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maroon"</span>,</span>
<span id="cb11-8">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>)</span>
<span id="cb11-9"></span>
<span id="cb11-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb11-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb11-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>,</span>
<span id="cb11-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/decompose2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="checking-normality-pictorially" class="level3">
<h3 class="anchored" data-anchor-id="checking-normality-pictorially">7) Checking Normality Pictorially</h3>
<section id="i-stem-and-leaf-plot" class="level4">
<h4 class="anchored" data-anchor-id="i-stem-and-leaf-plot">i) Stem and Leaf Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stem</span>(CPI_Data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">105</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  The decimal point is at the |

   0 | 5555555555555555555556666666666666666666677777788899
   1 | 00001111223344445556678889
   2 | 00334566899999
   3 | 0011111222333444444567777777778899
   4 | 000000111233444556777799
   5 | 001122223466788899
   6 | 02455788
   7 | 0012344466
   8 | 347
   9 | 4555679
  10 | 08
  11 | 19
  12 | 3
  13 | 35
  14 | 08
  15 | 014
  16 | 244777899
  17 | 00111112234445678
  18 | 1238
  19 | 0</code></pre>
</div>
</div>
<p>The above stem-and-leaf diagram shows the skewed distribution that CPI assumes. The skewness is to right.</p>
</section>
<section id="ii-histogram" class="level4">
<h4 class="anchored" data-anchor-id="ii-histogram">ii) Histogram</h4>
<p>The histogram in the figure below is skewed to the right, confirming what we found with the stem-and-leaf diagram. This skewness implies the data is not normally distributed. Furthermore, the skewness calls for log-transformation of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(CPI_Data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> CPI_Data)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">after_stat</span>(density)),</span>
<span id="cb14-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, </span>
<span id="cb14-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb14-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maroon"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb14-7">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue1"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribution of CPI"</span>,</span>
<span id="cb14-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CPI"</span>, </span>
<span id="cb14-10">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/histogram-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Histogram of Log Transformed CPI</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">LoggedCPI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>()  </span>
<span id="cb15-2">  </span>
<span id="cb15-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(LoggedCPI, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> LoggedCPI)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> ..density..),</span>
<span id="cb15-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, </span>
<span id="cb15-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span id="cb15-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maroon"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb15-9">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue1"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Logged Distribution of CPI"</span>,</span>
<span id="cb15-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CPI"</span>, </span>
<span id="cb15-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Density"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/histogram1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The histogram above with a superimposed kernel density plot for CPI log-transgeomed gives a vague hint of a bimodal distribution. This needs further transformation.</p>
</section>
<section id="iii-q-q-plot" class="level4">
<h4 class="anchored" data-anchor-id="iii-q-q-plot">iii) Q-Q Plot</h4>
<p>The plot below clearly illustrates how far the CPI is from the normal distribution. QQ Plots compare observed data to standardized theoretical normal data. The closeness of the plot to straight line indicates the closeness of the observed data to being normally distributed. For our case, the CPI deviates away at the tails to form an S-curve that defies normality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(CPI_Data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample=</span>CPI_Data))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_qq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maroon"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Q-Q Plot of CPI"</span>,</span>
<span id="cb16-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Theoretical"</span>, </span>
<span id="cb16-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/qq plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="checking-normality-formally" class="level3">
<h3 class="anchored" data-anchor-id="checking-normality-formally">8) Checking Normality Formally</h3>
<section id="i-jarque-bera-test" class="level4">
<h4 class="anchored" data-anchor-id="i-jarque-bera-test">i) Jarque Bera Test</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jarque.bera.test</span>() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># From package "tseries"</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Jarque Bera Test

data:  .
X-squared = 57.318, df = 2, p-value = 3.577e-13</code></pre>
</div>
</div>
<p>The hypothesis for this test is:-</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?H_0">: CPI is normally distributed,</li>
<li><img src="https://latex.codecogs.com/png.latex?H_a">: CPI is not normally distributed.</li>
</ul>
<p>Here, the p-value is smaller than 0.05 and thus we reject <img src="https://latex.codecogs.com/png.latex?H_0"> and conclude at 95% level of confidence that CPI is indeed significantly skewed.</p>
</section>
</section>
<section id="testing-stationarity-pictorially" class="level3">
<h3 class="anchored" data-anchor-id="testing-stationarity-pictorially">9) Testing Stationarity Pictorially</h3>
<section id="a-lagged-plots" class="level4">
<h4 class="anchored" data-anchor-id="a-lagged-plots">a) Lagged Plots</h4>
<p>The figure below shows plots of lags 1 to 20. The fact that there is a strong persistence of a straight line (autocorrelation) for lags above 20 excludes the dominance of an <strong>MA(q)</strong> in the series and gives a strong evidence for an <strong>AR(p)</strong>. This persistence is due to the strong correlation (0.987) at lag one. This property is also called long memory. However, the series cannot be simply an <strong>AR(p)</strong> since the order of such an <strong>AR(p)</strong> would be too large a number and <em>parsimony</em> (idea of <em>Occult’s Razor</em>) would be violated. Therefore, the lagged plots give evidence of an <strong>ARMA(p,q)</strong> being the underlying best-case scenario.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglagplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lag =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, </span>
<span id="cb19-2">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seasonal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb19-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viridis"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/lagging-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="b-acf-and-pacf" class="level4">
<h4 class="anchored" data-anchor-id="b-acf-and-pacf">b) ACF and PACF</h4>
<p>The figure below is a correlogram of ACF and ACF of CPI for the first 80 lags. The slowly decaying property in ACF further gives evidence of the series being non-stationary and hence an <strong>AR(p)</strong>. Because of the trend, the observations will usually be on the same side of the series’ global mean. The terms <img src="https://latex.codecogs.com/png.latex?(X(t+k)%E2%88%92%CE%BC(X))(X(t)%E2%88%92%CE%BC(X))"> are positive, for this reason, the ACF is positive as well and is close to one, i.e.&nbsp;0.987 at lag 1. The smooth, linear decline in ACF also is an indicator of the insignificance of the seasonal effect in the series as opposed to a wave-like decline for the seasonally strong series. Notice that ACF comes to zero at lag about 78, this is too persistent an effect of long term memory.</p>
<p>The PACF cuts off immediately after the associated lag. This is typical of non-stationary processes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggAcf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lag.max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb20-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CPI ACF"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/ACF-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggPacf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lag.max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb21-2">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CPI PACF"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/PACF-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="testing-stationarity-formally" class="level3">
<h3 class="anchored" data-anchor-id="testing-stationarity-formally">10) Testing Stationarity Formally</h3>
<section id="a-augmented-dickey-fuller-test-tests-for-unit-root" class="level4">
<h4 class="anchored" data-anchor-id="a-augmented-dickey-fuller-test-tests-for-unit-root">a) Augmented Dickey-Fuller Test (tests for unit root)</h4>
<p>The Augmented Dickey-Fuller (ADF) Test has the following hypothesis:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?H_0"> Unit root exists (non-stationary)</li>
<li><img src="https://latex.codecogs.com/png.latex?H_1">: No unit root Exists (stationary)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">adf.test</span>(CPI_Data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  CPI_Data
Dickey-Fuller = -0.52375, Lag order = 6, p-value = 0.9802
alternative hypothesis: stationary</code></pre>
</div>
</div>
<p>We fail to reject <img src="https://latex.codecogs.com/png.latex?H_0"> at 95% confidence level because <code>0.9802 &gt; 0.05</code>. The conclusion is that CPI for the period under study is not stationary. It follows from this conclusion that differencing is required to render the series stationary. As we have earlier deduced the underlying model to be <strong>ARMA(p,q)</strong>, we now have a strong evidence for <strong>ARIMA (p,d,q)</strong> where <strong>d</strong> is the number of times required to difference to achieve stationarity.</p>
</section>
<section id="b-ljung-box-text-tests-for-white-noise" class="level4">
<h4 class="anchored" data-anchor-id="b-ljung-box-text-tests-for-white-noise">b) Ljung-Box Text (tests for white noise)</h4>
<p>Testing stationarity by checking whether the data is white noise, Ljung-Box (1978) test was made use of. The test is based on whether the sample autocorrelation is equal to zero:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?H_0;%20%CF%81%20=%200"> White noise</li>
<li><img src="https://latex.codecogs.com/png.latex?H_1;%20%CF%81%20%E2%89%A0%200"> Not white noise.</li>
</ul>
<p>This test follows a Chi-square distribution. If the p-value is less than 0.05 at lag <img src="https://latex.codecogs.com/png.latex?h"> degrees of freedom, <img src="https://latex.codecogs.com/png.latex?H_0"> is rejected and differencing is done.</p>
<p>The test statistic is given as; <img src="https://latex.codecogs.com/png.latex?Q(h)%20=%20n(n+2)%E2%88%91%5Eh%20_%7Bk=1%7D%5Cfrac%7B%CF%81k%7D%7B(n%E2%88%92k)%7D"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Box.test</span>(CPI_Data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ljung-Box"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  CPI_Data
X-squared = 234.89, df = 1, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Clearly, the data is not white noise, we reject <img src="https://latex.codecogs.com/png.latex?H_0"> and difference the data to achieve stationarity.</p>
</section>
</section>
<section id="automatic-fitting-of-arimapdq" class="level3">
<h3 class="anchored" data-anchor-id="automatic-fitting-of-arimapdq">11) Automatic Fitting of ARIMA(p,d,q)</h3>
<p>Having established that CPI follows an <strong>ARIMA (p,d,q)</strong> model, we go ahead to find the best fitting model using AIC and BIC as the tools for choosing the parsimonious fit. The package <code>forecast</code> with appropriate dependencies installed, we are saved the trouble of transfoming the data to stabilize variance and seasonality before manually differencing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">CPIfit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CPI_Data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">auto.arima</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">approximation =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb26-2">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stepwise =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb26-3">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># trace = TRUE will print all the possible models</span></span>
<span id="cb26-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(CPIfit)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: . 
ARIMA(2,2,0)(2,0,1)[4] 

Coefficients:
          ar1      ar2     sar1     sar2    sma1
      -0.7461  -0.4174  -0.8993  -0.2587  0.8043
s.e.   0.0610   0.0596   0.0983   0.0644  0.0831

sigma^2 = 0.01867:  log likelihood = 137.05
AIC=-262.1   AICc=-261.74   BIC=-241.29

Training set error measures:
                      ME      RMSE        MAE        MPE     MAPE      MASE
Training set 0.002888028 0.1346216 0.06989758 0.08317552 1.286139 0.2097828
                    ACF1
Training set -0.03239534</code></pre>
</div>
</div>
<p>Notice that by setting approximation = FALSE and stepwise = FALSE a more advanced/rigorous search for a model in conducted. The best model has the smallest BIC and AIC. The non-seasonal order (2,2,0) means the series has a moving average of order 0, an autoregressive component of order 2, and the ARMA is differenced twice (d = 2) to achieve stationarity. The mathematical model is the product of <code>MA</code> and <code>AR</code> components.</p>
<p>A pure <strong>AR(p)</strong> model is one where <img src="https://latex.codecogs.com/png.latex?Y_t"> depends only on its own lags. That is, <img src="https://latex.codecogs.com/png.latex?Y_t"> is a function of the ‘lags of <img src="https://latex.codecogs.com/png.latex?Y_t">’:</p>
<p><img src="https://latex.codecogs.com/png.latex?Y_t=%CE%B1+%CE%B2_1Y_%7Bt%E2%88%921%7D+%CE%B2_2Y_%7Bt%E2%88%922%7D+...%CE%B2_pY_%7Bt%E2%88%92p%7D+%CF%B5_1"></p>
<p>A pure <strong>MA(q)</strong> is is one that <img src="https://latex.codecogs.com/png.latex?Y_t"> depends only on the lagged forecast errors and is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?Y_t=%CE%B1+%CF%B5_t+%CF%95_1%CF%B5_%7Bt%E2%88%921%7D+%CF%95_2%CF%B5_%7Bt%E2%88%922%7D+...%CF%95_%7Bt%E2%88%92q%7D"></p>
<p>Overall, ARIMA becomes:</p>
<p><img src="https://latex.codecogs.com/png.latex?Y_t=%CE%B1+%CE%B2_1Y_t%E2%88%921+%CE%B2_2Y_%7Bt%E2%88%922%7D+...+%CE%B2_pY_%7Bt%E2%88%92p%7D%CF%B5_t+%CF%95_1%CF%B5_%7Bt%E2%88%921%7D+%CF%95_2%CF%B5_%7Bt%E2%88%922%7D+...+%CF%95_q%CF%B5_%7Bt%E2%88%92q%7D"> Substituting the coefficients, this becomes: <img src="https://latex.codecogs.com/png.latex?Y_t=%CE%B1-0.7461Y_%7Bt%E2%88%921%7D-0.4174Y_%7Bt%E2%88%922%7D-0.8993%CF%B5_%7Bt%E2%88%921%7D-0.2587%CF%B5_%7Bt%E2%88%922%7D+0.8043%CF%B5_%7Bt%E2%88%923%7D"></p>
<section id="a-check-residuals-for-white-noise" class="level4">
<h4 class="anchored" data-anchor-id="a-check-residuals-for-white-noise">a) Check Residuals for White Noise</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">checkresiduals</span>(CPIfit)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/residuals-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(2,2,0)(2,0,1)[4]
Q* = 5.0548, df = 3, p-value = 0.1678

Model df: 5.   Total lags used: 8</code></pre>
</div>
</div>
<p>There are a few significant spikes in the ACF, and the model fails the Ljung-Box test. The model can still be used for forecasting, but the prediction intervals may not be accurate due to the correlated residuals. Sometimes it is just not possible to find a model that passes all of the tests.</p>
</section>
<section id="b-forecasting" class="level4">
<h4 class="anchored" data-anchor-id="b-forecasting">b) Forecasting</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">CPIforecast <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CPIfit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forecast</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">125</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forecast 5 (each with 4 seasons) years ahead of Sept 2020</span></span>
<span id="cb30-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span>))</span>
<span id="cb30-4"></span>
<span id="cb30-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># summary(CPIforecast) # Print forecasts</span></span></code></pre></div>
</div>
</section>
<section id="c-visualising-forecasts" class="level4">
<h4 class="anchored" data-anchor-id="c-visualising-forecasts">c) Visualising Forecasts</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">CPIforecast <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">autoplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/index_files/figure-html/visualise forecasts-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The point forcasts with both 95% CI and 99% CI are contained in <code>summary(CPIforecast)</code> for 33 years (each with 4 seasons) ahead of 2020, that is upto Q2 2053.</p>
<p><em>End</em></p>
<p><strong>Note</strong>: This post was first published by the author on <a href="https://rpubs.com/Cornelius_Tanui/567471">RPubs</a> in 2019.</p>


</section>
</section>

 ]]></description>
  <category>R</category>
  <category>time-series</category>
  <category>Smoothing</category>
  <guid>https://corneliustanui.rbind.io/content/posts/ARIMA_Fitting_2024-08-22/</guid>
  <pubDate>Mon, 08 Jan 2024 21:00:00 GMT</pubDate>
</item>
</channel>
</rss>
